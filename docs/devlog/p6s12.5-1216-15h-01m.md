# Part 6 Step 12.5 - 적응형 오버나이트 전략 완료

## 완료 시간: 2024-12-16 15:01

## 배경
기존 청산 로직이 고정값(15:50 무조건 청산)을 사용하여 시장 상황 무시.
적응형 로직으로 개선하여 오버나이트 킵 기회 활용.

## 수정된 파일

### 1. core/market_data.py
| 추가 메서드 | 기능 |
|------------|------|
| `get_atr()` | 20일 ATR 계산 |
| `get_vix_stats()` | VIX 평균/표준편차 (126일) |
| `get_daily_range_pct()` | 당일 변동폭 % |

### 2. strategy/green_mode.py
| 추가 메서드 | 기능 |
|------------|------|
| `should_keep_overnight()` | 조건부 킵 (bool 반환) |

**판단 기준:**
- 금요일 → 청산
- 손실 중 → 청산
- VWAP 거리 < daily_range × 0.5 → 청산
- 그 외 → **킵**

### 3. strategy/red_mode.py
| 추가 메서드 | 기능 |
|------------|------|
| `should_keep_overnight()` | 조건부 킵 (str 반환) |

**판단 기준:**
- VIX > vix_mean + vix_std → 전량 청산
- MA20 이탈 → 전량 청산
- daily_return > ATR × 2 → 50% 청산
- 금요일 → 50% 청산
- 그 외 → **전량 킵**

### 4. main.py
`_handle_pre_close()` 수정:
- 적응형 컨텍스트 수집
- 전략별 `should_keep_overnight()` 호출
- 결과에 따른 청산/킵 결정

## 적응형 파라미터 (고정값 X)

| 기존 (고정값) | 변경 (적응형) |
|--------------|--------------|
| VIX > 25 | VIX > vix_mean + vix_std |
| +3% 급등 | daily_return > ATR × 2 |
| VWAP 0.5% | daily_range × 0.5 |

## 테스트 결과
```
✅ 모듈 임포트 성공
```

## TODO (향후 구현)
- [ ] 실시간 가격 연동
- [ ] 실제 청산 주문 연결
- [ ] MA20 실시간 계산

## 다음 단계
→ Part 6 Step 13: Paper Trading 테스트
